# PR Reviewer Assignment Service (PRS)

Сервис для управления командами, пользователями и Pull Requests с автоматическим назначением ревьюверов.

---

## Структура проекта

- `cmd/app` — точка входа приложения.
- `internal/` — реализация хендлеров, репозиториев, моделей и сервисной логики.
- `migrations/` — SQL миграции для PostgreSQL.
- `docker-compose.yml` — для запуска приложения, БД и миграций.
- `dockerfile` — билд и запуск Go-приложения.
- `Makefile` — удобные команды для сборки и запуска.
- `.env` — конфигурация БД и порта приложения.

---

## Makefile

С помощью Makefile удобно запускать и управлять проектом через Docker Compose:

```bash
# Собрать бинарь приложения
make build

# Поднять сервис и БД (миграции выполняются автоматически)
make up

# Остановить все сервисы
make down

# Очистить базу и тома
make clean

# Линтинг
make lint

# Просмотр логов
make logs

# Применить миграции вручную (если нужно)
make migrate
```
---

## Примечания

```
- Все идентификаторы должны быть в формате UUID. 
(Сначала я решил использовать для идентификаторов тип UUID,но только при тестировании понял, что это неудобно. Был вариант вводить строку и по ней формировать UUID,
но поскольку функция кодирования в UUID односторонняя, декодирование обратно в строку оказалось невозможным.В итоге было решено оставить идентификаторы в формате UUID.)
- На некоторых системах для работы с Docker требуется `sudo`.
- Миграции выполняются автоматически при старте контейнера.
```
## Описание переменных окружения
```
- `POSTGRES_USER` - пользователь PostgreSQL
- `POSTGRES_PASSWORD` - пароль пользователя PostgreSQL  
- `POSTGRES_DB` - название базы данных
- `POSTGRES_PORT` - порт базы данных (5433 для избежания конфликтов)
- `DATABASE_URL` - полная строка подключения к базе данных
- `LOG_MODE` - режим логирования (`development`/`production`)
- `APP_PORT` - порт, на котором запускается приложение
```

---

## API

Полная спецификация API доступна в файле [`openapi.yml`](./api/openapi.yml).

Пример эндпоинта `/stats`:

**GET /stats** — возвращает статистику назначений ревьюверов:

```json
{
  "stats": [
    {"username": "Alice", "assigned_count": 5},
    {"username": "Bob", "assigned_count": 3}
  ]
}
```

--- 

## Lint

Для проверки кода используется `golangci-lint`.

```yaml
run:
  timeout: 5m           # Максимальное время выполнения линтера

linters:
  enable:
      # Обязательные для любого проекта
      - govet                    # Стандартные проверки
      - errcheck                 # Проверка обработки ошибок
      - staticcheck             # Статический анализ (включает simple, unused)
      - ineffassign             # Неэффективные присваивания
      
      # Качество кода
      - gosec                   # Безопасность
      - gocritic               # Критика кода
      - bodyclose              # Проверка закрытия HTTP body
      - sqlclosecheck          # Проверка закрытия SQL rows/transactions
      
      # Стиль кода
      - gocyclo                # Сложность функций
      - nestif                 # Вложенные if
      
      # Для работы с БД
      - rowserrcheck           # Проверка ошибок в rows.Scan
      - contextcheck           # Проверка передачи context
```

---

## Установка и запуск
1. Клонируйте репозиторий:
```bash
git clone https://github.com/F3dosik/PRS
cd PRS
```
2. Настройте переменные окружения в файле `.env`
   или скопируйте из файла .env.example:
```bash
cp .env.example .env
```
3. Соберите приложение
```bash
make build
```
4. Запустите все сервисы (Postgres, миграции, приложение)
```bash
make up
```
5. Просмотр логов
```bash
make logs
```
6. Остановить все сервисы
```bash 
make down
```
